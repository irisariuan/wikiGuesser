---
export const prerender = false;
import Game from "../../../components/Game";
import GameFooter from "../../../components/GameFooter.astro";
import MainLayout from "../../../layout/MainLayout.astro";
import { getChallengeById } from "../../../lib/server/challenge";
import { extractDataFromWiki } from "../../../lib/web";

const { id } = Astro.params;
if (!id) return Astro.redirect("/");
const parsedId = Number(id);
if (isNaN(parsedId)) return Astro.rewrite("/404.html");
const challenge = await getChallengeById(parsedId);
if (!challenge) return Astro.rewrite("/404.html");
const { title } = challenge;
const text = await extractDataFromWiki(title);
if (!text) return Astro.rewrite("/500.html");
---

<MainLayout subtitle="Game">
	<div class="flex flex-col items-center gap-4">
		{
			text && (
				<Game
					client:load
					text={text}
					encodedTitle={title}
					id={parsedId}
				/>
			)
		}
		<GameFooter title={title} extract={text.extract} />
	</div>
</MainLayout>
